<!DOCTYPE html>
<html>
  <div id="get_video_id" skill_id=<%= @skill.youtube.url_id %>></div>
  <div class="videos">
    <div class="block-video"> 
      <% if @skill.video.attached? %>
        <p><%=@skill.user.nickname%>さん</p>
        <%= video_tag rails_blob_path(@skill.video) ,size: "640x360" , loop: true, autoplay: true, muted: true ,class: "post-video"%>
      <%end %>
    </div>
    <div class="model-videos">
      <p>お手本</p>
      <div id="player" class="model-video"></div>
    </div>
  </div>

<script>
      // 2. This code loads the IFrame Player API code asynchronously.
      var tag = document.createElement('script');

      tag.src = "https://www.youtube.com/iframe_api";
      var firstScriptTag = document.getElementsByTagName('script')[0];
      firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

      // 3. This function creates an <iframe> (and YouTube player)
      //    after the API code downloads.
      var player;
      function onYouTubeIframeAPIReady() {
          const video = document.getElementById("get_video_id");
          const skillId = video.getAttribute("skill_id");
        player = new YT.Player('player', {
          autoplay: 1,
          loop: 1,
          videoId:  `${skillId}`,
          iv_load_policy: 3, //動画アノテーションを表示しない
          showinfo: 0,
          rel:0, //再生終了時に関連動画を表示しない
          events: {
            'onReady': onPlayerReady,
            // 'onStateChange': onPlayerStateChange
          }
        });
      }

      // 4. The API will call this function when the video player is ready.
      function onPlayerReady(event) {
        event.target.playVideo();
        setInterval(function(){
        event.target.seekTo(0);
        },8000);
      }

</script>
</html>